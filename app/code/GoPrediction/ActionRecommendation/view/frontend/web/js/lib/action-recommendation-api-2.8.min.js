!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.ActionRecommendationApi=t()}(void 0===this?window:this,function(){let e="http://cloud.goprediction.local/api";return{publicAccessKey:null,view:function(t,n){"function"!=typeof n&&(n=function(){});let o=new XMLHttpRequest;o.onreadystatechange=function(e){4===o.readyState&&n(o.responseText,o.status)},o.open("POST",e+"/action-recommendation/view",!0),o.setRequestHeader("Content-type","application/json"),o.send(JSON.stringify({customer:t.customer,product_id:t.product_id,is_referrer:t.is_referrer,public_access_key:this.publicAccessKey}))},purchase:function(t,n){"function"!=typeof n&&(n=function(){});let o=new XMLHttpRequest;o.onreadystatechange=function(e){4===o.readyState&&n(o.responseText,o.status)},o.open("POST",e+"/action-recommendation/purchase",!0),o.setRequestHeader("Content-type","application/json"),o.send(JSON.stringify({customer:t.customer,product_id:t.product_id,name:t.name,price:t.price,count:t.count,public_access_key:this.publicAccessKey}))},action:function(t,n){"function"!=typeof n&&(n=function(){});let o=new XMLHttpRequest;o.onreadystatechange=function(e){4===o.readyState&&n(o.responseText,o.status)},o.open("POST",e+"/action-recommendation/action",!0),o.setRequestHeader("Content-type","application/json"),o.send(JSON.stringify({customer:t.customer,product_id:t.product_id,public_access_key:this.publicAccessKey}))},query:function(t,n){let o=!0;"function"!=typeof n&&(o=!1,n=function(){});let i="&product_ids="+JSON.stringify(t.product_ids),c="?public_access_key="+this.publicAccessKey+"&count="+t.count+i,r=new XMLHttpRequest;if(r.onreadystatechange=function(e){4===r.readyState&&n(r.responseText,r.status)},r.open("GET",e+"/action-recommendation/query"+c,o),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("Accept","application/json"),r.send(),200===r.status)return r.responseText},_isReferrer:function(){var e=window.location.href;return-1!==e.indexOf("?gpr=1")||-1!==e.indexOf("&gpr=1")},_getHistory:function(e){"string"!=typeof e.action&&(e.action=""),e.action=e.action.charAt(0).toUpperCase()+e.action.slice(1);let t=JSON.parse(localStorage.getItem("_gpcCustomer"+e.action+"ActionHistory"));return Array.isArray(t)||(t=[]),t},_setHistory:function(e){"string"!=typeof e.action&&(e.action=""),e.action=e.action.charAt(0).toUpperCase()+e.action.slice(1);let t=JSON.parse(localStorage.getItem("_gpcCustomer"+e.action+"ActionHistory"));Array.isArray(t)||(t=[]),t.includes(e.produc_id)||t.push(e.product_id),t=t.slice(-5),localStorage.setItem("_gpcCustomer"+e.action+"ActionHistory",JSON.stringify(t))},_generateCustomerIdentifier:function(){let e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<32;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},_getCustomerIdentifier:function(){let e=localStorage.getItem("_gpcCustomerIdentifier");return e||(e=this._generateCustomerIdentifier(),localStorage.setItem("_gpcCustomerIdentifier",e)),e}}});
